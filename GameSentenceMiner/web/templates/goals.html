<!DOCTYPE html>
<html lang="en">

{% set page_title = 'GSM - Goals' %}
{% set page_specific_css = 'stats.css' %}
{% include 'components/html-head.html' %}

<body>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h1 style="margin: 0;">GSM - Goals</h1>
            <button id="addCustomGoalBtn" class="control-btn" style="display: flex; align-items: center; gap: 8px;">
                <span>‚ûï</span>
                <span>Add Custom Goal</span>
            </button>
        </div>

        <!-- Include shared navigation -->
        {% include 'components/navigation.html' %}

                <!-- Goals Today Card -->
        <div class="dashboard-card today-goals" id="todayGoalsCard" style="margin-bottom: 30px;">
            <div class="dashboard-card-header">
                <h3 class="dashboard-card-title">
                    <span class="dashboard-card-icon">üìÖ</span>
                    Dailies
                </h3>
                <p class="dashboard-card-subtitle" id="todayGoalsDate">Loading...</p>
            </div>
            
            <div id="noTargetsMessage" class="no-targets-message" style="display: none; text-align: center; padding: 40px 20px; color: var(--text-tertiary); font-style: italic;">
                Set target dates in settings to see your daily goals
            </div>

            <div class="dashboard-stats-grid" id="todayGoalsStats">
                <!-- Custom goals will be dynamically inserted here -->
            </div>

        </div>

        <!-- Goal Progress Chart -->
        <div class="dashboard-card goal-progress-chart" id="goalProgressChart" style="margin-bottom: 30px;">
            <div class="dashboard-card-header">
                <h3 class="dashboard-card-title">
                    <span class="dashboard-card-icon">üéØ</span>
                    Goal Progress Chart
                </h3>
                <p class="dashboard-card-subtitle">Track your reading goals and projected completion dates</p>
            </div>

            <div class="goal-progress-grid">
                <!-- Custom goals will be dynamically inserted here -->
            </div>

            <!-- Loading/Error states -->
            <div class="goal-progress-loading" id="goalProgressLoading" style="display: none;">
                <div class="spinner"></div>
                <span>Loading goal progress...</span>
            </div>

            <div class="goal-progress-error" id="goalProgressError" style="display: none;">
                <div class="goal-progress-error-icon">‚ö†Ô∏è</div>
                <div class="goal-progress-error-message">Failed to load goal progress</div>
                <button class="retry-btn" onclick="loadGoalProgress()">Retry</button>
            </div>
        </div>

        <!-- Your Stats by Goal Date Card -->
        <div class="dashboard-card projection-card" id="projectionCard" style="margin-bottom: 30px;">
            <div class="dashboard-card-header">
                <h3 class="dashboard-card-title">
                    <span class="dashboard-card-icon">üìä</span>
                    Your Stats by Goal Date
                </h3>
                <p class="dashboard-card-subtitle">Based on your 30-day average reading pace</p>
            </div>

            <div id="noProjectionsMessage" class="no-targets-message" style="display: none; text-align: center; padding: 40px 20px; color: var(--text-tertiary); font-style: italic;">
                Set target dates in settings to see projections
            </div>

            <div class="dashboard-stats-grid" id="projectionStats">
                <!-- Custom goals will be dynamically inserted here -->
            </div>

            <div class="dashboard-progress-section" id="projectionProgress" style="display: none;">
                <div class="dashboard-progress-title">Projection Summary</div>
                <div class="dashboard-progress-items">
                    <!-- Custom goal summaries will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <!-- Custom Goal Modal -->
        <div id="customGoalModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="customGoalModalTitle">Add Custom Goal</h3>
                    <span class="close-btn" id="closeCustomGoalModal">&times;</span>
                </div>
                <div class="modal-body">
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">
                        Create a custom goal to track your progress over a specific time period.
                    </p>
                    <form id="customGoalForm">
                        <div style="margin-bottom: 15px;">
                            <label for="goalName" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
                                Goal Name <span style="color: var(--danger-color);">*</span>
                            </label>
                            <input type="text" id="goalName" name="goalName" required
                                style="width: 90%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-tertiary); color: var(--text-primary); font-size: 14px;"
                                placeholder="e.g., Read 1M characters in January">
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label for="goalMetricType" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
                                Metric Type <span style="color: var(--danger-color);">*</span>
                            </label>
                            <select id="goalMetricType" name="goalMetricType" required
                                style="width: 95%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-tertiary); color: var(--text-primary); font-size: 14px;">
                                <option value="">Select metric type...</option>
                                <option value="hours">Reading Hours</option>
                                <option value="characters">Characters Read</option>
                                <option value="games">Games Completed</option>
                            </select>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label for="goalTargetValue" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
                                Target Value <span style="color: var(--danger-color);">*</span>
                            </label>
                            <input type="number" id="goalTargetValue" name="goalTargetValue" required min="1"
                                style="width: 90%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-tertiary); color: var(--text-primary); font-size: 14px;"
                                placeholder="e.g., 1000000">
                            <small style="color: var(--text-tertiary); font-size: 12px; margin-top: 4px; display: block;">
                                The target amount you want to achieve
                            </small>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label for="goalStartDate" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
                                    Start Date <span style="color: var(--danger-color);">*</span>
                                </label>
                                <input type="date" id="goalStartDate" name="goalStartDate" required
                                    style="width: 85%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-tertiary); color: var(--text-primary); font-size: 14px;">
                            </div>
                            <div>
                                <label for="goalEndDate" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
                                    End Date <span style="color: var(--danger-color);">*</span>
                                </label>
                                <input type="date" id="goalEndDate" name="goalEndDate" required
                                    style="width: 85%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-tertiary); color: var(--text-primary); font-size: 14px;">
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label for="goalIcon" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
                                Icon (Optional)
                            </label>
                            <input type="text" id="goalIcon" name="goalIcon" maxlength="2"
                                style="width: 90%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-tertiary); color: var(--text-primary); font-size: 14px;"
                                placeholder="e.g., üéØ (leave empty for default)">
                            <small style="color: var(--text-tertiary); font-size: 12px; margin-top: 4px; display: block;">
                                Enter an emoji to represent this goal
                            </small>
                        </div>
                    </form>

                    <div id="customGoalError" style="display: none; background: var(--danger-color); color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 14px;">
                    </div>
                    <div id="customGoalSuccess" style="display: none; background: var(--success-color); color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 14px;">
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancelCustomGoalBtn" class="cancel-btn">Cancel</button>
                    <button id="saveCustomGoalBtn" class="confirm-delete-btn">Save Goal</button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Goals Settings</h3>
                    <span class="close-btn" id="closeSettingsModal">&times;</span>
                </div>
                <div class="modal-body">
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">
                        Use custom goals to track your reading progress over specific time periods.
                    </p>
                    <form id="settingsForm">
                        <!-- Settings form is kept for potential future use -->
                        <p style="color: var(--text-tertiary); font-style: italic; text-align: center; padding: 20px;">
                            No settings available. Use the "Add Custom Goal" button to create goals.
                        </p>
                    </form>

                    <div id="settingsError"
                        style="display: none; background: var(--danger-color); color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 14px;">
                    </div>
                    <div id="settingsSuccess"
                        style="display: none; background: var(--success-color); color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 14px;">
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancelSettingsBtn" class="cancel-btn">Cancel</button>
                    <button id="saveSettingsBtn" class="confirm-delete-btn">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Include shared JavaScript configuration -->
    {% set config_vars = {} %}
    {% set config_object_name = 'statsConfig' %}
    {% set page_specific_js = 'goals.js' %}
    {% include 'components/js-config.html' %}

</body>

</html>