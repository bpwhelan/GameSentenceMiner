<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anki vs GSM Kanji Stats</title>
    
    <!-- Include html2canvas for screenshot functionality -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    
    <!-- Include Chart.js from a CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Include shared theme styles -->
    {% include 'components/theme-styles.html' %}
    
    <!-- Include shared CSS -->
    <link rel="stylesheet" href="/static/css/shared.css">
    
    <!-- Include stats-specific CSS -->
    <link rel="stylesheet" href="/static/css/stats.css">
    
    <!-- Include shared kanji grid CSS -->
    <link rel="stylesheet" href="/static/css/kanji-grid.css">
</head>
<body>

<div class="container">
    <h1>Anki & GSM Kanji Statistics</h1>
    <div style="text-align: center;">
        <p>Must have <a href="https://ankiweb.net/shared/info/2055492159">AnkiConnect</a></p>
    </div>

    <!-- Include shared navigation -->
    {% include 'components/navigation.html' %}

    <!-- Dashboard Statistics Sections -->
    <div class="dashboard-container">
        <!-- Missing High-Frequency Kanji Card -->
        <div class="dashboard-card current-game" id="missingKanjiCard">
            <div class="dashboard-card-header">
                <div>
                    <h3 class="dashboard-card-title">
                        <span class="dashboard-card-icon">üàö</span>
                        Missing High-Frequency Kanji
                    </h3>
                    <p class="dashboard-card-subtitle">Kanji seen often in GSM but not present in your Anki collection</p>
                </div>
                <div class="dashboard-streak-indicator" id="missingKanjiStreak" style="display: none;">
                    <span id="missingStreakValue">0</span> to learn
                </div>
            </div>
            
            <div class="dashboard-stats-grid" id="missingKanjiStats">
                <div class="dashboard-stat-item tooltip" data-tooltip="Number of high-frequency kanji missing from Anki">
                    <span class="dashboard-stat-value" id="missingKanjiCount">-</span>
                    <span class="dashboard-stat-label">Missing Kanji</span>
                </div>
                <div class="dashboard-stat-item tooltip" data-tooltip="Total kanji in your Anki collection">
                    <span class="dashboard-stat-value" id="ankiTotalKanji">-</span>
                    <span class="dashboard-stat-label">Kanji in Anki</span>
                </div>
                <div class="dashboard-stat-item tooltip" data-tooltip="Total unique kanji seen in GSM">
                    <span class="dashboard-stat-value" id="gsmTotalKanji">-</span>
                    <span class="dashboard-stat-label">Kanji in GSM</span>
                </div>
                <div class="dashboard-stat-item tooltip" data-tooltip="Percentage of GSM kanji covered by Anki">
                    <span class="dashboard-stat-value" id="ankiCoverage">-</span>
                    <span class="dashboard-stat-label">Coverage %</span>
                </div>
            </div>
            
            <div class="dashboard-progress-section">
                <div class="dashboard-progress-title">Missing Kanji Grid</div>
                <div id="missingKanjiGridContainer">
                    <div id="missingKanjiGrid" class="kanji-grid"></div>
                    <div class="kanji-legend">
                        <span>Rarely Seen</span>
                        <div class="kanji-legend-item" style="background-color: #ebedf0;" title="No encounters"></div>
                        <div class="kanji-legend-item" style="background-color: #e6342e;" title="Seen once"></div>
                        <div class="kanji-legend-item" style="background-color: #e6dc2e;" title="Occasionally seen"></div>
                        <div class="kanji-legend-item" style="background-color: #3be62f;" title="Frequently seen"></div>
                        <div class="kanji-legend-item" style="background-color: #2ee6e0;" title="Most frequently seen"></div>
                        <span>Frequently Seen</span>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Loading/Error states for dashboard -->
    <div class="dashboard-loading" id="ankiStatsLoading" style="display: none;">
        <div class="spinner"></div>
        <span>Loading Anki statistics...</span>
    </div>

    <div class="dashboard-error" id="ankiStatsError" style="display: none;">
        <div class="dashboard-error-icon">‚ö†Ô∏è</div>
        <div class="dashboard-error-message">Failed to load Anki statistics</div>
        <button class="dashboard-retry-btn" data-action="loadAnkiStats">Retry</button>
    </div>


    <!-- Settings Modal -->
    <div id="ankiSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Anki Statistics Settings</h3>
                <span class="close-btn" id="closeAnkiSettingsModal">&times;</span>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    Configure how Anki statistics and kanji analysis are calculated.
                </p>
                
                <form id="ankiSettingsForm">
                    <div style="margin-bottom: 20px;">
                        <label for="frequencyThreshold" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
                            Minimum Frequency Threshold
                        </label>
                        <input
                            type="number"
                            id="frequencyThreshold"
                            name="frequency_threshold"
                            min="1"
                            max="1000"
                            style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-tertiary); color: var(--text-primary); font-size: 14px;"
                            placeholder="10"
                        >
                        <small style="color: var(--text-tertiary); font-size: 12px; margin-top: 4px; display: block;">
                            Minimum times a kanji must appear in GSM to be considered for analysis (1-1000)
                        </small>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="coverageTarget" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
                            Coverage Target (%)
                        </label>
                        <input
                            type="number"
                            id="coverageTarget"
                            name="coverage_target"
                            min="50"
                            max="100"
                            style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-tertiary); color: var(--text-primary); font-size: 14px;"
                            placeholder="95"
                        >
                        <small style="color: var(--text-tertiary); font-size: 12px; margin-top: 4px; display: block;">
                            Target percentage coverage for Anki collection (50-100%)
                        </small>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label for="learningGoal" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
                            Daily Learning Goal
                        </label>
                        <input
                            type="number"
                            id="learningGoal"
                            name="learning_goal"
                            min="1"
                            max="50"
                            style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-tertiary); color: var(--text-primary); font-size: 14px;"
                            placeholder="5"
                        >
                        <small style="color: var(--text-tertiary); font-size: 12px; margin-top: 4px; display: block;">
                            Target number of new kanji to learn per day (1-50)
                        </small>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label for="priorityMode" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">
                            Priority Mode
                        </label>
                        <select
                            id="priorityMode"
                            name="priority_mode"
                            style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background: var(--bg-tertiary); color: var(--text-primary); font-size: 14px;"
                        >
                            <option value="frequency">By Frequency</option>
                            <option value="jlpt">By JLPT Level</option>
                            <option value="grade">By School Grade</option>
                            <option value="mixed">Mixed Approach</option>
                        </select>
                        <small style="color: var(--text-tertiary); font-size: 12px; margin-top: 4px; display: block;">
                            How to prioritize kanji for learning recommendations
                        </small>
                    </div>
                </form>
                
                <div id="ankiSettingsError" style="display: none; background: var(--danger-color); color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 14px;"></div>
                <div id="ankiSettingsSuccess" style="display: none; background: var(--success-color); color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 14px;"></div>
            </div>
            <div class="modal-footer">
                <button id="cancelAnkiSettingsBtn" class="cancel-btn">Cancel</button>
                <button id="saveAnkiSettingsBtn" class="confirm-delete-btn">Save Settings</button>
            </div>
        </div>
    </div>
</div>

<!-- Include Settings Modal Component -->
{% include 'components/settings-modal.html' %}

<!-- Include shared JavaScript first (required dependency for anki_stats.js) -->
<script src="/static/js/shared.js"></script>
<script src="/static/js/kanji-grid.js"></script>
<script src="/static/js/anki_stats.js"></script>

</body>
</html>